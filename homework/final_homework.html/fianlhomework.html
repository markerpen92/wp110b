<html>
    <head>
        <title id="bookmark">Sign In</title>
        <style>
            body
            {
	            text-align:center;
                border:5px blue solid;
                border-width: 10px;
                padding:15px 10px;
                font-size:2em;
                height: 600px;
                width: 500px;
                margin: 30 auto 0 auto;
            }
            #chat_room
            {
                text-align:left
            }
            .show_friend
            {
                text-align:center;
                border:5px black solid;
                font-size:20px;
                border-width: 5px;
                height: 460px;
                width: 350px;
                float: right;
                margin-right: 25pxs;
            }
            .Signin_panel
            {
                float: center;
                border:5px black solid;
                margin-top: 40px;
                margin-left: 22px;
                border-width: 5px;
                height: 370px;
                width: 450px;
                padding-top: 60px;
            }
            .Signup_panel
            {
                float: center;
                border:5px black solid;
                margin-top: 40px;
                margin-left: 22px;
                border-width: 5px;
                height: 450px;
                width: 450px;
            }
            .term_panel
            {
                border:5px black solid;
                height: 450px;
                width: 350px;
                margin-left: 67px;
            }
            .Add_frienf_panel
            {
                margin-left: 75px;
                border: 3px black solid;
                width: 350px;
                height: 450px;
            }
            #left_button
            {
                height: 30px; 
                margin-top: 20px;
                margin-left: 15px;
                float: left;
                width: 90px;
            }
            #signup_button
            {
                height: 30px; 
                width:  70px;
            }
            #login_button
            {
                height: 30px; 
                width:  70px;
            }
            #back_inside
            {
                margin-top: 20px;
                width: 60px;
                height: 28px;
            }
            #friend_button
            {
                height: 50px; 
                width:  150px;
                margin-top: 10px;
            }
        </style>
    </head>

    <body>
        <section>
            <div class="panel" id="login" style="margin-bottom:100px ;"> <!--製作一個登入的介面-->
                <h1 style="margin-bottom:5px ; font-size:2em;">-Login-</h1>
                <hr/>
                <div class="Signin_panel">
                    <p id="login_name">Username  :&nbsp;&nbsp;<input type="text" id="loginname" ></p>
                    <p id="login_account">Account   :&nbsp;&nbsp;<input type="text" id="loginaccount" ></p>
                    <p id="login_password" style="padding-bottom:40px">Password  :&nbsp;&nbsp;<input type="text" id="loginpassword"></p>
                    <p><input type="button" value="Login" onclick="afterlogin()" id="login_button" style="float:right; margin-right: 140px; margin-top: 5px;"></p>
                    <p id="login_to_signup"><input type="button" value="SignUP" style="float:left; margin-left : 140px; margin-top: 5px;" id="login_button" onclick="signup()"></p>
                </div>
            </div>       
            <div class="panel" id="signup"> <!--製作一個註冊的介面-->
                <h1 style="margin-bottom: 10px;">-Sign In-</h1>
                <hr/>
                <div class="Signup_panel">
                    <p>Username  :&nbsp;&nbsp;<input type="text" id="username"  placeholder="Sign in your username"></p>
                    <p>Account   :&nbsp;&nbsp;<input type="text" id="account"   placeholder="_ @ _ .com"           ></p>
                    <p>Password  :&nbsp;&nbsp;<input type="text" id="password"  placeholder=""                     ></p>
                    <p>Phone     :&nbsp;&nbsp;<input type="text" id="phone"     placeholder=""                     ></p>
                    <p>I agree<input type="checkbox" id="check"><a href="#/terms/">terms of service</a></p>
                    <p><input type="button" value="Save" onclick="save()" style="float:right; margin-right: 140px;" id="signup_button"></p>
                    <p><input type="button" value="Back" onclick="login()" style="float:left; margin-left : 140px;"  id="signup_button"></p>    
                </div> 
            </div>
            <div class="panel" id="terms"> <!--製作閱讀服務條款介面-->
                <h1 style="font-size:60px ; margin-bottom: 5px;">-Terms Of Service-</h1>
                <hr/>
                <div class="term_panel">
                    <p>NOTHING</p>
                </div> 
                <p  style="margin-top:6px ;"><a href="#/signup/">Back to Signup</a></p>
            </div>   
            <div class="panel" id="inside" style="padding-right: 10px;">
                <h1 id="inside_title" style="margin-bottom: 5px;">-Welcome-</h1>
                <hr/>
                <p><input type="button" value="Add Friend" onclick="Add_friend()" id="left_button"></p>
                <div class="show_friend">
                    <h1>-Friend List-</h1>
                    <div id="show_friend_detail">
                        <a href="#/npc/">MR.Mark</a>
                    </div>
                </div>
                <p><input type="button" value="Logout" onclick="login()" id="left_button"></p>
            </div>
            <div id="npc" class="panel">
                <div>
                    <p style="font-size:50px ; margin-bottom:10px ; margin-top: 20px;">Talk : <input type="text" id="user_talk" onkeydown="keyin(event)" style="height:50px ; width:170px ; padding:1px; font-size:30px;"></p>             
                    <!--<input type="button" value="Submit" onclick="talking()">-->
                </div>
                <div id="chat_room" style="width: 480px;; height: 445px; overflow:auto; border:ridge 5px #888888; margin: 5px; margin-top: 25px;">
                    Mark : 您好!<BR/>  
                </div>
                <div>
                    <input type="button" value="Back" onclick="inside()" style="width:70px ; height:35px ; margin-top: 5px;">
                </div>
            </div>
            <div id="Add_Friend" class="panel">
                <h1 style="margin-bottom:5px ;">-Add Friend-</h1>
                <hr/>
                <div class="Add_frienf_panel">
                    <input type="button" value="Mark-I" id="friend_button" onclick=" Add_friend_inlist('Mark-I')">
                    <input type="button" value=Mark-XVI" id="friend_button" onclick=" Add_friend_inlist('Mark-XVI')">
                    <input type="button" value="Mark-XCII" id="friend_button" onclick=" Add_friend_inlist('Mark-XCII')">
                    <input type="button" value="Markerpen" id="friend_button" onclick=" Add_friend_inlist('Markerpen')">
                </div>
                <input type="button" value="Back" id="back_inside" onclick="inside()">
            </div>       
        </section>
        <script>
            function show(id)
            {
                document.querySelectorAll('.panel').forEach((node) => node.style.display='none')
                document.getElementById(id).style.display = 'block'    
            }
            let users = []//當作一個資料庫來儲存使用者的帳號密碼
            function save() //註冊完成後儲存
            {
                var name     = document.getElementById('username').value
                var account  = document.getElementById("account" ).value
                var password = document.getElementById("password").value
                var phone    = document.getElementById("phone"   ).value
                if(account.match(account.match(/\w+(\.\w+){0}\@\w+(\.\w+)+/g)) && name!="" && account!="" && password!="" && phone.match(/09[0-9]{8}/g))
                {
                    var c= document.getElementById("check").checked
                    if(c)
                    {
                        if(name.length>=3 && name.length<=8)
                        {
                            users.push({username:name , account:account , password:password , phonenumber:phone , friend_I:0 , friend_XVI:0 , friend_XCII:0 , friend_markerpen:0})    
                            window.location.hash = "#/login/"
                        }
                        else
                        {
                            alert("Your username must be 3 to 8 characters")
                            document.getElementById("username").value = ""
                        }
                    }
                    else
                    {
                        alert("Accept service of terms please")
                    }
                }
                else
                {
                    if(! account.match(account.match(/\w+(\.\w+){0}\@\w+(\.\w+)+/g)))
                    {
                        alert("Your account's form is not allow!")
                        document.getElementById("account" ).value = ""
                    }
                    if(! phone.match(/09[0-9]{8}/g))
                    {
                        alert("Your phonenumber's form is not allow!")
                        document.getElementById("phone"   ).value = ""
                    }
                    document.getElementById("check"   ).checked = false
                }                    
            }
            var for_record_insideuser
            function afterlogin() //檢查使用者登入時輸入的帳號密碼
            {
                var username = document.getElementById("loginname").value
                var useraccount = document.getElementById("loginaccount").value
                var userpassword = document.getElementById("loginpassword").value
                for(let i=0 ; i<users.length ; i++)
                {  //比對使用者輸入的帳號密碼是否正確
                        if(username == users[i].username)
                        {
                            if(useraccount==users[i].account && userpassword==users[i].password)
                            {
                                for_record_insideuser = i
                                inside() //當登入成功時
                            }
                            else 
                            {//登入失敗時
                                if(useraccount!=users[i].account && userpassword==users[i].password)
                                {
                                    alert("Your account isn't correct")
                                }
                                else if(useraccount==users[i].account && userpassword!=users[i].password)
                                {
                                    alert("Your password isn't correct")
                                }
                                else
                                {
                                    alert("Your acount and password both are not correct")
                                } 
                            }
                            document.getElementById("loginname").value     = ""
                            document.getElementById("loginaccount").value  = ""
                            document.getElementById("loginpassword").value = ""
                            break
                        }  
                        else if(i==users.length-1 && username!=users[i].username)
                        {
                            alert("Wrong username!")
                            document.getElementById("loginname").value     = ""
                            document.getElementById("loginaccount").value  = ""
                            document.getElementById("loginpassword").value = ""
                        }                                    
                }
            }
            function signup() //註冊帳號
            { 
                show("signup")
                if(page_type==0)
                {
                    document.getElementById("bookmark").innerHTML="Sign Up"
                    document.getElementById("username").value = ""
                    document.getElementById("account" ).value = ""
                    document.getElementById("password").value = ""
                    document.getElementById("phone"   ).value = ""
                    document.getElementById("check"   ).checked = false
                }
                else if(page_type==1)
                {
                    page_type=0
                    document.getElementById("check"   ).checked = false
                }
                window.location.hash="#/signup/"
            }
            function login()
            {
                show("login")
                document.getElementById("bookmark").innerHTML="Sign In"
                document.getElementById("loginname"    ).value = ""
                document.getElementById("loginaccount" ).value = ""
                document.getElementById("loginpassword").value = ""
                window.location.hash="#/login/"
            }
            var welcome_username;
            function inside()
            {
                document.getElementById("show_friend_detail").innerHTML='<a href="#/npc/">MR.Mark</a>'
                document.getElementById("inside_title").innerHTML="-Welcome  "+document.getElementById("loginname").value+"-"
                if(document.getElementById("loginname").value=="")
                {
                    document.getElementById("inside_title").innerHTML="-Welcome  "+welcome_username+"-"
                }
                else
                {
                    welcome_username=document.getElementById("loginname").value
                }
                if(users[for_record_insideuser].friend_I==1)
                {
                    document.getElementById("show_friend_detail").innerHTML+='<br/><br/><a href="#/npc/">Mark-I</a>'
                }
                if(users[for_record_insideuser].friend_XVI==1)
                {
                    document.getElementById("show_friend_detail").innerHTML+='<br/><br/><a href="#/npc/">Mark-XVI</a>'
                }
                if(users[for_record_insideuser].friend_XCII==1)
                {
                    document.getElementById("show_friend_detail").innerHTML+='<br/><br/><a href="#/npc/">Mark-XCII</a>'
                }
                if(users[for_record_insideuser].friend_markerpen==1)
                {
                    document.getElementById("show_friend_detail").innerHTML+='<br/><br/><a href="#/npc/">Markerpen</a>'
                }
                show("inside")
                window.location.hash="#/inside/"
                document.getElementById("bookmark").innerHTML="Welcome"
            }   
            var page_type=0        
            function terms()
            {
                show("terms")
                page_type=1
            }
            function npc()
            {
                chat_room.innerHTML=" Mark : 您好!<BR/>"
                show("npc")
                window.location.hash="#/npc/"
            }
            function Add_friend()
            {
                var i=users[for_record_insideuser].friend_I + users[for_record_insideuser].friend_XVI + users[for_record_insideuser].friend_XCII + users[for_record_insideuser].friend_markerpen
                if(i>=4)
                {
                    alert("You have enough friend")
                }
                else
                {
                    show("Add_Friend")
                    window.location="#/Add_Friend/"
                }
            }
            function Add_friend_inlist(name)
            {
                if(name == "Mark-I")
                {
                    if(users[for_record_insideuser].friend_I==1)
                    {
                        alert(name+" is already your friend")
                        return
                    }
                    else
                    {
                        users[for_record_insideuser].friend_I++
                        document.getElementById("show_friend_detail").innerHTML+='<br/><br/><a href="#/npc/">Mark-I</a>'
                        window.location="#/inside/"
                    }
                }
                if(name == "Mark-XVI")
                {
                    if(users[for_record_insideuser].friend_XVI==1)
                    {
                        alert(name+" is already your friend")
                        return
                    }
                    else
                    {
                        users[for_record_insideuser].friend_XVI++
                        document.getElementById("show_friend_detail").innerHTML+='<br/><br/><a href="#/npc/">Mark-XVI</a>'
                        window.location="#/inside/"
                    }
                }
                if(name == "Mark-XCII")
                {
                    if(users[for_record_insideuser].friend_XCII==1)
                    {
                        alert(name+" is already your friend")
                        return
                    }
                    else
                    {
                        users[for_record_insideuser].friend_XCII++
                        document.getElementById("show_friend_detail").innerHTML+='<br/><br/><a href="#/npc/">Mark-XCII</a>'
                        window.location="#/inside/"
                    }
                }
                if(name == "Markerpen")
                {
                    if(users[for_record_insideuser].friend_markerpen==1)
                    {
                        alert(name+" is already your friend")
                        return
                    }
                    else
                    {
                        users[for_record_insideuser].friend_markerpen++
                        document.getElementById("show_friend_detail").innerHTML+='<br/><br/><a href="#/npc/">Markerpen</a>'
                        window.location="#/inside/"
                    }
                }
            }
            let routmap = [
                [/^\/?login\/?$/  , login],
                [/^\/?signup\/?$/ , signup],
                [/^\/?npc\/?$/ , npc],
                [/^\/?terms\/?$/ , terms],
                [/^\/?inside\/?$/ , inside]
            ]
            window.onload = function()
            {
                show("login")
                window.location.hash = "#/login/"
            }
            window.onhashchange = function()
            {
                var hash=window.location.hash.trim().substring(1)
                for(let [rout,f] of routmap)
                {
                    var m=hash.match(rout)
                    if(m)
                    {
                        f()
                        break
                    }
                }
            }
            var qaList = [
            { Q:"謝謝", A:"不客氣!"},
            { Q:"你很" , A:"你才*!"},
            { Q:"對不起|抱歉|不好意思", A:"別說抱歉 !|別客氣，儘管說 !"},
            { Q:"可否|可不可以", A:"你確定想*?"},
            { Q:"我想", A:"你為何想*?"},
            { Q:"我要", A:"你為何要*?"},
            { Q:"你是", A:"你認為我是*?"},
            { Q:"不認為" , A:"為何你不認為*?"},
            { Q:"認為|以為", A:"為何說*?"},
            { Q:"感覺", A:"常有這種感覺嗎?"},
            { Q:"為何不", A:"你希望我*!"},
            { Q:"是否", A:"為何想知道是否*?"},
            { Q:"不能", A:"為何不能*?|你試過了嗎?|或許你現在能*了呢?"},
            { Q:"我是", A:"你好，久仰久仰!"},
            { Q:"甚麼|什麼|何時|誰|哪裡|如何|為何|因何", A:"為何這樣問?|為何你對這問題有興趣?|你認為答案是甚麼呢?|你認為如何呢?|你常問這類問題嗎?|這真的是你想知道的嗎?|為何不問問別人?|你曾有過類似的問題嗎?|你問這問題的原因是甚麼呢?"},
            { Q:"原因", A:"這是真正的原因嗎?|還有其他原因嗎?"}, 
            { Q:"理由", A:"這說明了甚麼呢?|還有其他理由嗎?"},
            { Q:"你好|嗨|您好|哈囉", A:"你好，有甚麼問題嗎?"},
            { Q:"或許", A:"你好像不太確定?"},
            { Q:"不曉得|不知道", A:"為何不知道?|在想想看，有沒有甚麼可能性?"},
            { Q:"不想|不希望", A:"有沒有甚麼辦法呢?|為何不想*呢?|那你希望怎樣呢?"}, 
            { Q:"想|希望", A:"為何想*呢?|真的想*?|那就去做阿?為何不呢?"},
            { Q:"不", A:"為何不*?|所以你不*?"},
            { Q:"請", A:"我該如何*呢?|你想要我*嗎?"},
            { Q:"你", A:"你真的是在說我嗎?|別說我了，談談你吧!|為何這麼關心我*?|不要再說我了，談談你吧!|你自己*"},
            { Q:"總是|常常", A:"能不能具體說明呢?|何時?"},
            { Q:"像", A:"有多像?|哪裡像?"},
            { Q:"對", A:"你確定嗎?|我了解!"},
            { Q:"朋友", A:"多告訴我一些有關他的事吧!|你認識他多久了呢?"},
            { Q:"電腦", A:"你說的電腦是指我嗎?"}, 
            { Q:"難過", A:"別想它了|別難過|別想那麼多了|事情總是會解決的"},
            { Q:"高興", A:"不錯ㄚ|太棒了|這樣很好ㄚ"},
            { Q:"是阿|是的", A:"甚麼事呢?|我可以幫助你嗎?|我希望我能幫得上忙!"},
            { Q:"累" , A:"那你應該多休息"},
            { Q:"餓" , A:"你沒吃飯?"},
            { Q:"", A:"我了解|我能理解|還有問題嗎 ?|請繼續說下去|可以說的更詳細一點嗎?|這樣喔! 我知道!|然後呢? 發生甚麼事?|再來呢? 可以多說一些嗎|接下來呢? |可以多告訴我一些嗎?|多談談有關你的事，好嗎?|想多聊一聊嗎|可否多告訴我一些呢?"}
            ];  
            function keyin(event)
            { 
                var keyCode = event.which
                if (keyCode == 13) talking()
            }
            function talking()
            {
                var user_talk = document.getElementById("user_talk").value
                if(user_talk=="")
                {
                    alert("Please Enter something")
                }
                else
                {
                    showdialog(user_talk)
                    var npc_talk = npc_answer(user_talk)
                    showdialog("Mark : " + npc_talk)
                    document.getElementById("user_talk").value = ""
                }
            }
            function showdialog(talk)
            {
                var chat_room = document.getElementById("chat_room")
                chat_room.innerHTML += talk+"<br/>\n"
                chat_room.scrollTop = chat_room.scrollHeight
            }
            function npc_answer(talk)
            {
                if(talk[talk.length-1]=="阿" || talk[talk.length-1]=="啊" || talk[talk.length-1]=="啦" || talk[talk.length-1]=="呀")
                {
                    talk[length-1]=""
                }
                for(let i=0 ; i<qaList.length ; i++)
                { 
                    var q_List = qaList[i].Q.split("|")
                    var a_List = qaList[i].A.split("|")
                    for(let j=0 ; j<q_List.length ; j++)
                    {                  
                        var r = new RegExp("(.*)"+q_List[j]+"([^?.;]*)", "gi")   
                        try
                        {
                            if(q_List[j]==talk)
                            {
                                var random = Math.floor(Math.random()*a_List.length)
                                return a_List[random]
                            }
                            else if(q_List[j]!=talk && talk.match(r))
                            {
                                var random = Math.floor(Math.random()*a_List.length)
                                var counter = talk.length
                                for(let k=0 ; k<=a_List[random].length ; k++)
                                {
                                    if(a_List[random][k]=="*")
                                    {
                                        let y=counter-3 
                                        var noun = [];
                                        if(counter<3)
                                        {
                                            y=0
                                        }
                                        for(; y<counter ; y++)
                                        {
                                            if(talk[y]==undefined)
                                            {
                                                talk[y]=""
                                            }
                                            noun+=talk[y]
                                        }
                                        var answerA = []
                                        for(let d=0 ; d<k ; d++)
                                        {
                                            answerA+=a_List[random][d]
                                        }
                                        if(answerA[answerA.length-1] == noun[0])
                                        {
                                            var accurate_noun = []
                                            for(let s=1 ; s<noun.length ; s++)
                                            {
                                                accurate_noun+=noun[s]
                                            }
                                            if(a_List[random][a_List[random].length-1]=="?")
                                            {
                                                accurate_noun+="?"
                                            }
                                            accurate_noun=accurate_noun.replace("我","#").replace("你","我").replace("#","你")
                                            return answerA+accurate_noun
                                        }
                                        if(a_List[random][a_List[random].length-1]=="?")
                                        {
                                            noun+="?"
                                        }
                                        noun=noun.replace("我","#").replace("你","我").replace("#","你")
                                        return answerA+noun
                                    }
                                }
                                return a_List[random]
                            }
                        }
                        catch
                        {}                  
                    }
                }
                var random = Math.floor(Math.random()*qaList[qaList.length-1].length)
                var answer_List = qaList[qaList.length-1].A.split("|")
                return answer_List[random]
            }
            </script>    
    </body>
</html>
